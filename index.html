<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form dengan Dropdown Dinamis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.2/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        label {
            display: block;
            margin-top: 10px;
        }
        select {
            margin-bottom: 20px;
            padding: 5px;
        }
        #spListContainer {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>Form Pemilihan Micro Cluster dan Code DSE</h1>

    <form id="dynamicForm">
        <label for="microCluster">Micro Cluster:</label>
        <select id="microCluster" name="microCluster" onchange="updateCodeDSE()">
            <option value="">-- Pilih Micro Cluster --</option>
            <option value="MC-BANJARBARU">MC-BANJARBARU</option>
            <option value="MC-BARABAI">MC-BARABAI</option>
            <option value="MC-KANDANGAN">MC-KANDANGAN</option>
            <option value="MC-BANJARMASIN">MC-BANJARMASIN</option>
            <option value="MC-BARITO KUALA">MC-BARITO KUALA</option>
            <option value="MC-BATULICIN">MC-BATULICIN</option>
            <option value="MC-PELAIHARI">MC-PELAIHARI</option>
            <option value="MC-KAPUAS">MC-KAPUAS</option>
            <option value="MC-MUARA TEWEH">MC-MUARA TEWEH</option>
            <option value="MC-PALANGKARAYA">MC-PALANGKARAYA</option>
            <option value="MC-BERAU">MC-BERAU</option>
            <option value="MC-TARAKAN">MC-TARAKAN</option>
        </select>

        <label for="codeDSE">Code DSE (ID Mobil):</label>
        <select id="codeDSE" name="codeDSE">
            <option value="">-- Pilih Code DSE --</option>
        </select>

        <label for="fileUpload">Upload File Excel:</label>
        <input type="file" id="fileUpload" accept=".xls,.xlsx">

        <div id="spListContainer"></div>
        <button type="submit">Submit</button>
    </form>

    <script>
        // Peta data untuk ID Outlet berdasarkan Micro Cluster
        const idMobils = {
            "MC-BANJARBARU": ["CSOMCMTP1", "CSOMCMTP11", "CSOMCMTP2", "CSOMCMTP4", "CSOMCMTP5", "CSOMCMTP6"],
            "MC-BARABAI": ["CSOMCBRB1", "CSOMCBRB2", "CSOMCBRB3", "CSOMCBRB4", "CSOMCTJG5"],
            "MC-KANDANGAN": ["CSOMCBRB10", "CSOMCBRB5", "CSOMCBRB7", "CSOMCBRB8", "CSOMCBRB9"],
            "MC-BANJARMASIN": ["BJMGADGETAYA", "CSOB-BJM06", "CSOB-BJM-07", "CSOB-BJM1", "CSOB-BJM2", "CSOB-BJM4", "CSOB-BJM5", "CSOB-MTP2", "EXP-BJB01", "MCBJMAGUSTSANI", "MCBJMARIESPRAS", "MCBJMBAHRUDIN", "MCBJMBAMBANG", "MCBJMHENDRY", "MTPABANGBAIM"],
            "MC-BARITO KUALA": ["CSOB-BJM3", "MCBJMAHMAD", "MCBJMANWARIFUADI", "MCBJMBAKERAN", "MCBJMFAHRULRAZI"],
            "MC-BATULICIN": ["CSOB-BTL04", "CSOB-BTL2", "CSOB-BTL7", "CSOB-BTL8", "JUMADINFARHAN02", "RUSDIANSYAHBTL"],
            "MC-PELAIHARI": ["ANWARI", "CSOB-BTL5", "EXP-BJB02", "MC-PLH1", "MURNIMUSTAFA1", "REZASATRIAHARDI"],
            "MC-KAPUAS": ["ALFIKPS", "HERMANKPS1", "HERYKPS", "KPS01", "KPS02", "KPS03", "SUWANDIKPS1"],
            "MC-MUARA TEWEH": ["PKY01", "TEWEH-AVANDI", "TEWEH-HUSAINI", "TEWEH-IJLANNAIS", "TEWEH-MURNI", "TEWEH-RUDIYANI", "TEWH-PAJRIANSYAH", "TWH02"],
            "MC-PALANGKARAYA": ["PLK-CSO01", "PLK-DAVID", "PLK-EDYLESMANA", "PLK-ISMAJAYA", "PLK-RAFIAL", "PLK-RENO", "PLK-RISKYNOVA", "PLK-RIZALI", "PLK-SURIYANI"],
            "MC-BERAU": ["ANGGIKHARISMA", "ARDIPRATAMA", "CSO-BERAU01", "DEDIALFIAN1", "JHODYSYAHARUDDIN"],
            "MC-TARAKAN": ["CSO-TARAKAN-03", "TRK-BUDI", "TRK-NURSALAM", "TRK-TEGUH"]
        };

        // Event listener untuk mengupdate pilihan ID Outlet berdasarkan pilihan Micro Cluster
        function updateCodeDSE() {
            const microCluster = document.getElementById('microCluster').value;
            const codeDSESelect = document.getElementById('codeDSE');
            
            // Mengosongkan dropdown ID Outlet
            codeDSESelect.innerHTML = ''; 
            const defaultOption = document.createElement('option');
            defaultOption.text = '-- Pilih Code DSE --';
            codeDSESelect.add(defaultOption);
            
            // Menambahkan opsi baru berdasarkan pilihan Micro Cluster
            if (microCluster && idMobils[microCluster]) {
                idMobils[microCluster].forEach((mob) => {
                    const option = document.createElement('option');
                    option.value = mob;
                    option.text = mob;
                    codeDSESelect.add(option);
                });
            }
        }

        document.getElementById('fileUpload').addEventListener('change', handleFile);

        function handleFile(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function (e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];

                // Mengambil data dari kolom A (dari A2 kebawah)
                const range = XLSX.utils.decode_range(worksheet['!ref']);
                const spList = [];
                for (let row = 2; row <= range.e.r; row++) { // mulai dari A2
                    const cellAddress = `A${row + 1}`; // karena Excel 1-based index
                    const cell = worksheet[cellAddress];
                    if (cell) {
                        spList.push(cell.v); // ambil nilai dari sel
                    }
                }

                // Menampilkan SP List
                displaySPList(spList);
            };
            reader.readAsArrayBuffer(file);
        }

        function displaySPList(spList) {
            const spListContainer = document.getElementById('spListContainer');
            spListContainer.innerHTML = ''; // Mengosongkan sebelumnya

            spList.forEach((sp) => {
                const spItem = document.createElement('div');
                spItem.textContent = sp; // Menampilkan SP
                spListContainer.appendChild(spItem);
            });
        }

        document.getElementById("dynamicForm").addEventListener("submit", function(event) {
            event.preventDefault();
            alert("Form submitted!");
        });
    </script>
</body>
</html>
